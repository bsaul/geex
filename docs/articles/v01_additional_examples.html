<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Additional calculus of M-estimation examples using `geex` â€¢ geex</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Additional calculus of M-estimation examples using `geex`">
<meta property="og:description" content="geex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geex</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bsaul/geex" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Additional calculus of M-estimation examples
using <code>geex</code>
</h1>
                        <h4 data-toc-skip class="author">Bradley
Saul</h4>
            
            <h4 data-toc-skip class="date">2022-07-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bsaul/geex/blob/HEAD/vignettes/v01_additional_examples.Rmd" class="external-link"><code>vignettes/v01_additional_examples.Rmd</code></a></small>
      <div class="hidden name"><code>v01_additional_examples.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<p>This vignette implements examples from and is meant to read with
<span class="citation">Stefanski and Boos (2002)</span> (SB). Examples
4-9 use the <code>geexex</code> data set. For information on how the
data are generated, run <code><a href="../reference/geexex.html">help('geexex')</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bsaul/geex" class="external-link">geex</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Attaching package: 'geex'</span></code></pre>
<pre><code><span class="co">## The following object is masked from 'package:methods':</span>
<span class="co">## </span>
<span class="co">##     show</span></code></pre>
</div>
<div class="section level2">
<h2 id="the-basic-approach">The Basic Approach<a class="anchor" aria-label="anchor" href="#the-basic-approach"></a>
</h2>
<div class="section level3">
<h3 id="example-4-instrumental-variables">Example 4: Instrumental variables<a class="anchor" aria-label="anchor" href="#example-4-instrumental-variables"></a>
</h3>
<p>Example 4 calculates an instumental variable estimator. The variables
(<span class="math inline">\(Y_3, W_1, Z_1\)</span>) are observed
according to:</p>
<p><span class="math display">\[
Y_{3i} = \alpha + \beta X_{1i} + \sigma_{\epsilon}\epsilon_{1, i}
\]</span></p>
<p><span class="math display">\[
W_{1i} =\beta X_{1i} + \sigma_{U}\epsilon_{2, i}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
Z_{1i} = \gamma + \delta X_{1i} + \sigma_{\tau}\epsilon_{3, i}.
\]</span></p>
<p><span class="math inline">\(Y_3\)</span> is a linear function of a
latent variable <span class="math inline">\(X_1\)</span>, whose
coefficient <span class="math inline">\(\beta\)</span> is of interest.
<span class="math inline">\(W_1\)</span> is a measurement of the
unobserved <span class="math inline">\(X_1\)</span>, and <span class="math inline">\(Z_1\)</span> is an instrumental variable for <span class="math inline">\(X_1\)</span>. The instrumental variable estimator
is <span class="math inline">\(\hat{\beta}_{IV}\)</span> is the ratio of
least squares regression slopes of <span class="math inline">\(Y_3\)</span> on <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Y_3\)</span> and <span class="math inline">\(W_1\)</span>. The <span class="math inline">\(\psi\)</span> function below includes this
estimator as <span class="math inline">\(\hat{\theta}_4 =
\hat{\beta}_{IV}\)</span>. In the example data, 100 observations are
generated where <span class="math inline">\(X_1 \sim \Gamma(\text{shape}
= 5, \text{rate} = 1)\)</span>, <span class="math inline">\(\alpha =
2\)</span>, <span class="math inline">\(\beta = 3\)</span>, <span class="math inline">\(\gamma = 2\)</span>, <span class="math inline">\(\delta = 1.5\)</span>, <span class="math inline">\(\sigma_{\epsilon} = \sigma_{\tau} = 1\)</span>,
<span class="math inline">\(\sigma_U = .25\)</span>, and <span class="math inline">\(\epsilon_{\cdot, i} \sim N(0,1)\)</span>.</p>
<p><span class="math display">\[
\psi(Y_{3i}, Z_{1i}, W_{1i}, \mathbf{\theta}) =
\begin{pmatrix}
\theta_1 - Z_{1i} \\
\theta_2 - W_{1i} \\
(Y_{3i} - \theta_3 W_{1i})(\theta_2 - W_{1i}) \\
(Y_{3i} - \theta_4 W_{1i})(\theta_1 - Z_{1i}) \\
\end{pmatrix}
\]</span></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB4_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Z1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Z1</span>; <span class="va">W1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">W1</span>; <span class="va">Y3</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y3</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Z1</span>,
        <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">W1</span>,
        <span class="op">(</span><span class="va">Y3</span> <span class="op">-</span> <span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">W1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">W1</span><span class="op">)</span>,
        <span class="op">(</span><span class="va">Y3</span> <span class="op">-</span> <span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="va">W1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Z1</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB4_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>, 
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The R packages <a href="https://cran.r-project.org/package=AER" class="external-link"><code>AER</code></a> and
<a href="https://cran.r-project.org/package=ivpack" class="external-link"><code>ivpack</code></a>
can compute the IV estimator and sandwich variance estimators
respectively, which is done below for comparison.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ivfit</span> <span class="op">&lt;-</span> <span class="fu">AER</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AER/man/ivreg.html" class="external-link">ivreg</a></span><span class="op">(</span><span class="va">Y3</span> <span class="op">~</span> <span class="va">W1</span> <span class="op">|</span> <span class="va">Z1</span>, data <span class="op">=</span> <span class="va">geexex</span><span class="op">)</span>
<span class="va">iv_se</span> <span class="op">&lt;-</span> <span class="fu">ivpack</span><span class="fu">::</span><span class="fu">cluster.robust.se</span><span class="op">(</span><span class="va">ivfit</span>, clusterid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ivfit</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> 
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>
<span class="va">iv_se</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'Std. Error'</span><span class="op">]</span> 
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="connections-to-the-influence-curve">Connections to the Influence Curve<a class="anchor" aria-label="anchor" href="#connections-to-the-influence-curve"></a>
</h2>
<div class="section level3">
<h3 id="example-5-hodges-lehmann-estimator">Example 5: Hodges-Lehmann estimator<a class="anchor" aria-label="anchor" href="#example-5-hodges-lehmann-estimator"></a>
</h3>
<p>This example shows the link between the influence curves and the
Hodges-Lehman estimator.</p>
<p><span class="math display">\[
\psi(Y_{2i}, \theta) =
\begin{pmatrix}
IC_{\hat{\theta}_{HL}}(Y_2; \theta_0) - (\theta_1 - \theta_0) \\
\end{pmatrix}
\]</span></p>
<p>The functions used in <code>SB5_estFUN</code> are defined below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">F0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">theta0</span>, <span class="va">distrFUN</span> <span class="op">=</span> <span class="va">pnorm</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">distrFUN</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">theta0</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">f0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">densFUN</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">densFUN</span><span class="op">(</span><span class="va">y</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">integrand</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">densFUN</span> <span class="op">=</span> <span class="va">dnorm</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">f0</span><span class="op">(</span><span class="va">y</span>, densFUN <span class="op">=</span> <span class="va">densFUN</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="va">IC_denom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="va">integrand</span>, lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, upper <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB5_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Yi</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="st">'Y2'</span><span class="op">]</span><span class="op">]</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>

     <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">IC_denom</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu">F0</span><span class="op">(</span><span class="va">Yi</span>, <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB5_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>,
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <code>hc.loc</code> of the <a href="https://cran.r-project.org/package=ICSNP" class="external-link"><code>ICSNP</code></a>
package computes the Hodges-Lehman estimator and SB gave closed form
estimators for the variance.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_cls</span> <span class="op">&lt;-</span> <span class="fu">ICSNP</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ICSNP/man/hl.loc.html" class="external-link">hl.loc</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">$</span><span class="va">Y2</span><span class="op">)</span>
<span class="va">Sigma_cls</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">12</span> <span class="op">*</span> <span class="va">IC_denom</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $geex</span>
<span class="co">## $geex$parameters</span>
<span class="co">## [1] 2.026376</span>
<span class="co">## </span>
<span class="co">## $geex$vcov</span>
<span class="co">##            [,1]</span>
<span class="co">## [1,] 0.01040586</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## $cls</span>
<span class="co">## $cls$parameters</span>
<span class="co">## [1] 2.024129</span>
<span class="co">## </span>
<span class="co">## $cls$vcov</span>
<span class="co">## [1] 0.01047198</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="non-smooth-psi-functions">Non-smooth <span class="math inline">\(\psi\)</span> functions<a class="anchor" aria-label="anchor" href="#non-smooth-psi-functions"></a>
</h2>
<div class="section level3">
<h3 id="example-6-huber-center-of-symmetry-estimator">Example 6: Huber center of symmetry estimator<a class="anchor" aria-label="anchor" href="#example-6-huber-center-of-symmetry-estimator"></a>
</h3>
<p>This example illustrates estimation with nonsmooth <span class="math inline">\(\psi\)</span> function for computing the <span class="citation">Huber (1964)</span> estimator of the center of
symmetric distributions.</p>
<p><span class="math display">\[
\psi_k(Y_{1i}, \theta) =
\begin{cases}
(Y_{1i} - \theta)  &amp; \text{when } |(Y_{1i} - \theta)| \leq k \\
k * sgn(Y_{1i} - \theta) &amp;  \text{when } |(Y_{1i} - \theta)| &gt;
k\\
\end{cases}
\]</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB6_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">k</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Y1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y1</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">Y1</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">k</span><span class="op">)</span> <span class="va">x</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">k</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB6_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>,
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The point estimate from <code>geex</code> is compared to the estimate
obtained from the <code>huber</code> function in the <a href="https://cran.r-project.org/package=MASS" class="external-link"><code>MASS</code></a>
package. The variance estimate is compared to an estimator suggested by
SB: <span class="math inline">\(A_m = \sum_i [-\psi'(Y_i -
\hat{\theta})]/m\)</span> and <span class="math inline">\(B_m = \sum_i
\psi_k^2(Y_i - \hat{\theta})/m\)</span>, where <span class="math inline">\(\psi_k'\)</span> is the derivative of <span class="math inline">\(\psi\)</span> where is exists.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_cls</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/huber.html" class="external-link">huber</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">$</span><span class="va">Y1</span>, k <span class="op">=</span> <span class="fl">1.5</span>, tol <span class="op">=</span> <span class="fl">1e-10</span><span class="op">)</span><span class="op">$</span><span class="va">mu</span>

<span class="va">psi_k</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">k</span><span class="op">)</span> <span class="va">x</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">k</span>
<span class="op">}</span>

<span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">$</span><span class="va">Y1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">theta_cls</span>
  <span class="op">-</span><span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html" class="external-link">grad</a></span><span class="op">(</span><span class="va">psi_k</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">$</span><span class="va">Y1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">theta_cls</span>
  <span class="fu">psi_k</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## closed form covariance</span>
<span class="va">Sigma_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">A</span> <span class="op">*</span> <span class="va">B</span> <span class="op">*</span> <span class="fl">1</span><span class="op">/</span><span class="va">A</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">geexex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span>, vcov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">)</span>, 
                cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">theta_cls</span>, vcov <span class="op">=</span> <span class="va">Sigma_cls</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span></code></pre></div>
<pre><code><span class="co">## $geex</span>
<span class="co">## $geex$parameters</span>
<span class="co">## [1] 4.82061</span>
<span class="co">## </span>
<span class="co">## $geex$vcov</span>
<span class="co">##            [,1]</span>
<span class="co">## [1,] 0.08356179</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## $cls</span>
<span class="co">## $cls$parameters</span>
<span class="co">## [1] 4.999386</span>
<span class="co">## </span>
<span class="co">## $cls$vcov</span>
<span class="co">##           [,1]</span>
<span class="co">## [1,] 0.0928935</span></code></pre>
</div>
<div class="section level3">
<h3 id="example-7-sample-quantiles-approximation-of-psi">Example 7: Sample quantiles (approximation of <span class="math inline">\(\psi\)</span>)<a class="anchor" aria-label="anchor" href="#example-7-sample-quantiles-approximation-of-psi"></a>
</h3>
<p><em>Approximation of <span class="math inline">\(\psi\)</span> with
geex is EXPERIMENTAL.</em></p>
<p>Example 7 illustrates calculation of sample quantiles using
M-estimation and approximation of the <span class="math inline">\(\psi\)</span> function.</p>
<p><span class="math display">\[
\psi(Y_{1i}, \theta) =
\begin{pmatrix}
0.5 - I(Y_{1i} \leq \theta_1) \\
\end{pmatrix}
\]</span></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB7_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Y1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y1</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
    <span class="fl">0.5</span>  <span class="op">-</span> <span class="op">(</span><span class="va">Y1</span> <span class="op">&lt;=</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Note that <span class="math inline">\(\psi\)</span> is not
differentiable; however, <code>geex</code> includes the ability to
approximate the <span class="math inline">\(\psi\)</span> function via
an <code>approx_control</code> object. The <code>FUN</code> in an
<code>approx_control</code> must be a function that takes in the <span class="math inline">\(\psi\)</span> function, modifies it, and returns a
function of <code>theta</code>. For this example, I approximate <span class="math inline">\(\psi\)</span> with a spline function. The
<code>eval_theta</code> argument is used to modify the basis of the
spline.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spline_approx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">psi</span>, <span class="va">eval_theta</span><span class="op">)</span><span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span><span class="op">(</span><span class="va">eval_theta</span><span class="op">)</span>
  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">splinefun</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">eval_theta</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu">f</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB7_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>, 
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">4.7</span><span class="op">)</span>,
  approx_control  <span class="op">=</span> <span class="fu"><a href="../reference/setup_approx_control.html">setup_approx_control</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="va">spline_approx</span>,
                                      eval_theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, by <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>A comparison of the variance is not obvious, so no comparison is
made.</p>
<pre><code><span class="co">## $geex</span>
<span class="co">## $geex$parameters</span>
<span class="co">## [1] 4.7</span>
<span class="co">## </span>
<span class="co">## $geex$vcov</span>
<span class="co">##           [,1]</span>
<span class="co">## [1,] 0.1773569</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## $cls</span>
<span class="co">## $cls$parameters</span>
<span class="co">## [1] 4.708489</span>
<span class="co">## </span>
<span class="co">## $cls$vcov</span>
<span class="co">## [1] NA</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="regression-m-estimators">Regression M-estimators<a class="anchor" aria-label="anchor" href="#regression-m-estimators"></a>
</h2>
<div class="section level3">
<h3 id="example-8-robust-regression">Example 8: Robust regression<a class="anchor" aria-label="anchor" href="#example-8-robust-regression"></a>
</h3>
<p>Example 8 demonstrates robust regression for estimating <span class="math inline">\(\beta\)</span> from 100 observations generated
from <span class="math inline">\(Y_4 = 0.1 + 0.1 X_{1i} + 0.5 X_{2i} +
\epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i \sim
N(0, 1)\)</span>, <span class="math inline">\(X_1\)</span> is defined as
above, and the first half of the observation have <span class="math inline">\(X_{2i} = 1\)</span> and the others have <span class="math inline">\(X_{2i} = 0\)</span>.</p>
<p><span class="math display">\[
\psi_k(Y_{4i}, \theta) =
\begin{pmatrix}
\psi_k(Y_{4i} - \mathbf{x}_i^T \beta) \mathbf{x}_i
\end{pmatrix}
\]</span></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psi_k</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span> <span class="op">=</span> <span class="fl">1.345</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">k</span><span class="op">)</span> <span class="va">x</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">k</span>
<span class="op">}</span>

<span class="va">SB8_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Yi</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y4</span>
  <span class="va">xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">Y4</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
    <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">Yi</span> <span class="op">-</span> <span class="va">xi</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="va">theta</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">psi_k</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="va">xi</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB8_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>,
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rlm.html" class="external-link">rlm</a></span><span class="op">(</span><span class="va">Y4</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">geexex</span>, method <span class="op">=</span> <span class="st">'M'</span><span class="op">)</span>
<span class="va">theta_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="va">Sigma_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span>, vcov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">)</span>, 
                cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">theta_cls</span>, vcov <span class="op">=</span> <span class="va">Sigma_cls</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span></code></pre></div>
<pre><code><span class="co">## $geex</span>
<span class="co">## $geex$parameters</span>
<span class="co">## [1] -0.04050369  0.14530196  0.30181589</span>
<span class="co">## </span>
<span class="co">## $geex$vcov</span>
<span class="co">##             [,1]          [,2]          [,3]</span>
<span class="co">## [1,]  0.05871932 -0.0101399730 -0.0133230841</span>
<span class="co">## [2,] -0.01013997  0.0021854268  0.0003386202</span>
<span class="co">## [3,] -0.01332308  0.0003386202  0.0447117633</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## $cls</span>
<span class="co">## $cls$parameters</span>
<span class="co">## (Intercept)          X1          X2 </span>
<span class="co">##  -0.0377206   0.1441181   0.2988842 </span>
<span class="co">## </span>
<span class="co">## $cls$vcov</span>
<span class="co">##             (Intercept)            X1            X2</span>
<span class="co">## (Intercept)  0.07309914 -0.0103060747 -0.0241724792</span>
<span class="co">## X1          -0.01030607  0.0020579145  0.0005364106</span>
<span class="co">## X2          -0.02417248  0.0005364106  0.0431120686</span></code></pre>
</div>
<div class="section level3">
<h3 id="example-9-generalized-linear-models">Example 9: Generalized linear models<a class="anchor" aria-label="anchor" href="#example-9-generalized-linear-models"></a>
</h3>
<p>Example 9 illustrates estimation of a generalized linear model.</p>
<p><span class="math display">\[
\psi(Y_i, \theta) =
\begin{pmatrix}
D_i(\beta)\frac{Y_i - \mu_i(\beta)}{V_i(\beta) \tau}
\end{pmatrix}
\]</span></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB9_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y5</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">Y5</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">data</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
    <span class="va">lp</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="va">theta</span>
    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span>
    <span class="va">D</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">dlogis</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span>
    <span class="va">V</span>  <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span>
    <span class="va">D</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">Y</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB9_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">geexex</span>, 
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Compare point estimates to <code>glm</code> coefficients and
covariance matrix to <code>sandwich</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y5</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">geexex</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">'logit'</span><span class="op">)</span><span class="op">)</span>
<span class="va">theta_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m9</span><span class="op">)</span>
<span class="va">Sigma_cls</span> <span class="op">&lt;-</span> <span class="fu">sandwich</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sandwich/man/sandwich.html" class="external-link">sandwich</a></span><span class="op">(</span><span class="va">m9</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>geex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span>, vcov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">)</span>,  
                cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">theta_cls</span>, vcov <span class="op">=</span> <span class="va">Sigma_cls</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span></code></pre></div>
<pre><code><span class="co">## $geex</span>
<span class="co">## $geex$parameters</span>
<span class="co">## [1] -1.1256071  0.3410619 -0.1148368</span>
<span class="co">## </span>
<span class="co">## $geex$vcov</span>
<span class="co">##             [,1]         [,2]         [,3]</span>
<span class="co">## [1,]  0.35202094 -0.058906883 -0.101528787</span>
<span class="co">## [2,] -0.05890688  0.012842435  0.004357355</span>
<span class="co">## [3,] -0.10152879  0.004357355  0.185455144</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## $cls</span>
<span class="co">## $cls$parameters</span>
<span class="co">## (Intercept)          X1          X2 </span>
<span class="co">##  -1.1256070   0.3410619  -0.1148368 </span>
<span class="co">## </span>
<span class="co">## $cls$vcov</span>
<span class="co">##             (Intercept)           X1           X2</span>
<span class="co">## (Intercept)  0.35201039 -0.058903546 -0.101534539</span>
<span class="co">## X1          -0.05890355  0.012841392  0.004358926</span>
<span class="co">## X2          -0.10153454  0.004358926  0.185456314</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="application-to-test-statistics">Application to test statistics<a class="anchor" aria-label="anchor" href="#application-to-test-statistics"></a>
</h2>
<div class="section level3">
<h3 id="example-10-testing-equality-of-success-probabilities">Example 10: Testing equality of success probabilities<a class="anchor" aria-label="anchor" href="#example-10-testing-equality-of-success-probabilities"></a>
</h3>
<p>Example 10 illustrates testing equality of success probablities.</p>
<p><span class="math display">\[
\psi(Y_i, n_i, \theta) =
\begin{pmatrix}
\frac{(Y_i - n_i \theta_2)^2}{n_i \theta_2( 1 - \theta_2 )} - \theta_1
\\
Y_i - n_i \theta_2
\end{pmatrix}
\]</span></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SB10_estFUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">ft_made</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">ft_attp</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>
    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">Y</span> <span class="op">-</span> <span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span>  <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, 
      <span class="va">Y</span> <span class="op">-</span> <span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/m_estimate.html">m_estimate</a></span><span class="op">(</span>
  estFUN <span class="op">=</span> <span class="va">SB10_estFUN</span>, 
  data  <span class="op">=</span> <span class="va">shaq</span>, 
  units <span class="op">=</span> <span class="st">'game'</span>, 
  root_control <span class="op">=</span> <span class="fu"><a href="../reference/setup_root_control.html">setup_root_control</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">V11</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">k</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">shaq</span><span class="op">)</span>
  <span class="va">sumn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">shaq</span><span class="op">$</span><span class="va">ft_attp</span><span class="op">)</span>
  <span class="va">sumn_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">shaq</span><span class="op">$</span><span class="va">ft_attp</span><span class="op">)</span>
  <span class="va">term2_n</span>  <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">6</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">6</span> <span class="op">*</span> <span class="va">p</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">term2_d</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span> 
  <span class="va">term2</span>  <span class="op">&lt;-</span> <span class="va">term2_n</span><span class="op">/</span><span class="va">term2_d</span>
  <span class="va">term3</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">sumn</span><span class="op">/</span><span class="va">k</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span>
  <span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">term2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">k</span><span class="op">)</span> <span class="op">*</span> <span class="va">sumn_inv</span><span class="op">)</span> <span class="op">-</span> <span class="va">term3</span>
<span class="op">}</span>

<span class="va">p_tilde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">shaq</span><span class="op">$</span><span class="va">ft_made</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">shaq</span><span class="op">$</span><span class="va">ft_attp</span><span class="op">)</span>
<span class="va">V11_hat</span> <span class="op">&lt;-</span> <span class="fu">V11</span><span class="op">(</span><span class="va">p_tilde</span><span class="op">)</span><span class="op">/</span><span class="fl">23</span>

<span class="co"># Compare variance estimates</span>
<span class="va">V11_hat</span></code></pre></div>
<pre><code><span class="co">## [1] 0.0783097</span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] 0.1929791</span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note the differences in the p-values</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fl">35.51</span><span class="op">/</span><span class="fl">23</span>, mean  <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">V11_hat</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.02596785</span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, 
      mean <span class="op">=</span> <span class="fl">1</span>, 
      sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
      lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.1078138</span></code></pre>
<p>This example shows that the empircal sandwich variance estimator may
be different from other sandwich variance estimators that make
assumptions about the structure of the <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> matrices.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-huber1964" class="csl-entry">
Huber, Peter J. 1964. <em>Robust Estimation of a Location Parameter</em>
35.
</div>
<div id="ref-stefanski2002" class="csl-entry">
Stefanski, Len A., and Dennis D. Boos. 2002. <em>The Calculus of
M-Estimation</em> 56. <a href="https://doi.org/10.1198/000313002753631330" class="external-link">https://doi.org/10.1198/000313002753631330</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bradley Saul.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
